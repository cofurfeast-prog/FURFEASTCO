{% extends 'furfeast/base.html' %}
{% load static %}

{% block title %}Shop All Products | FURFEAST CO.{% endblock %}

{% block content %}
<main>
    <!-- Page Header -->
    <section class="bg-background py-10 md:py-16">
        <div class="max-w-[1440px] mx-auto px-4 sm:px-6 lg:px-12 text-center md:text-left">
            <h1 class="text-3xl md:text-4xl font-heading font-extrabold text-foreground mb-2">
                Shop All Products
            </h1>
            <p class="text-muted-foreground max-w-2xl">
                Discover premium nutrition and accessories for your beloved pets. From grain-free meals to engaging
                toys, we have everything to keep your best friend happy and healthy.
            </p>
        </div>
    </section>

    <!-- Shop Content -->
    <section class="py-12 bg-background">
        <div class="max-w-[1440px] mx-auto px-4 sm:px-6 lg:px-12">
            <div class="flex flex-col lg:flex-row gap-8 lg:gap-12">

                <!-- Filter Sidebar -->
                <aside class="w-full lg:w-1/4 shrink-0 space-y-8">
                    <div class="lg:sticky lg:top-28">
                        <div class="flex items-center justify-between lg:block mb-4">
                            <h3 class="font-bold text-foreground flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3" />
                                </svg>
                                Filters
                            </h3>
                            <button id="filter-toggle"
                                class="lg:hidden text-sm font-bold text-primary flex items-center gap-1">
                                <span>Expand Filters</span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="transition-transform">
                                    <path d="m6 9 6 6 6-6" />
                                </svg>
                            </button>
                        </div>

                        <div id="filter-content" class="hidden lg:block space-y-8 animate-fade-in">
                            <div>
                                <h4 class="text-xs font-bold text-muted-foreground uppercase tracking-wider mb-4">Categories
                                </h4>
                                <div class="space-y-2">
                                    <a href="{% url 'shop' %}" class="flex items-center gap-3 group">
                                        <div
                                            class="w-8 h-8 rounded-lg flex items-center justify-center {% if not category_slug %}bg-primary text-white shadow-glow{% else %}bg-slate-50 text-slate-400 group-hover:bg-primary/10 group-hover:text-primary{% endif %} transition-all">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round">
                                                <rect width="7" height="7" x="3" y="3" rx="1" />
                                                <rect width="7" height="7" x="14" y="3" rx="1" />
                                                <rect width="7" height="7" x="14" y="14" rx="1" />
                                                <rect width="7" height="7" x="3" y="14" rx="1" />
                                            </svg>
                                        </div>
                                        <span
                                            class="text-sm text-foreground group-hover:text-primary transition-colors {% if not category_slug %}font-bold text-primary{% endif %}">All
                                            Categories</span>
                                    </a>
                                    <a href="/shop/?category=dog-food" class="flex items-center gap-3 group">
                                        <div
                                            class="w-8 h-8 rounded-lg flex items-center justify-center {% if category_slug == 'dog-food' %}bg-primary text-white shadow-glow{% else %}bg-slate-50 text-slate-400 group-hover:bg-primary/10 group-hover:text-primary{% endif %} transition-all">
                                            <span>üê∂</span>
                                        </div>
                                        <span
                                            class="text-sm text-foreground group-hover:text-primary transition-colors {% if category_slug == 'dog-food' %}font-bold text-primary{% endif %}">Dog
                                            Food</span>
                                    </a>
                                    <a href="/shop/?category=cat-food" class="flex items-center gap-3 group">
                                        <div
                                            class="w-8 h-8 rounded-lg flex items-center justify-center {% if category_slug == 'cat-food' %}bg-primary text-white shadow-glow{% else %}bg-slate-50 text-slate-400 group-hover:bg-primary/10 group-hover:text-primary{% endif %} transition-all">
                                            <span>üê±</span>
                                        </div>
                                        <span
                                            class="text-sm text-foreground group-hover:text-primary transition-colors {% if category_slug == 'cat-food' %}font-bold text-primary{% endif %}">Cat
                                            Food</span>
                                    </a>
                                    <a href="/shop/?category=accessories" class="flex items-center gap-3 group">
                                        <div
                                            class="w-8 h-8 rounded-lg flex items-center justify-center {% if category_slug == 'accessories' %}bg-primary text-white shadow-glow{% else %}bg-slate-50 text-slate-400 group-hover:bg-primary/10 group-hover:text-primary{% endif %} transition-all">
                                            <span>üéæ</span>
                                        </div>
                                        <span
                                            class="text-sm text-foreground group-hover:text-primary transition-colors {% if category_slug == 'accessories' %}font-bold text-primary{% endif %}">Accessories</span>
                                    </a>
                                </div>
                            </div>

                            <div>
                                <h3 class="font-bold text-foreground mb-4">Price Range</h3>
                                <form method="GET" class="space-y-4">
                                    {% for key, value in request.GET.items %}
                                        {% if key != 'min_price' and key != 'max_price' %}
                                        <input type="hidden" name="{{ key }}" value="{{ value }}">
                                        {% endif %}
                                    {% endfor %}
                                    <div class="flex items-center gap-3">
                                        <input type="number" name="min_price" placeholder="Min" value="{{ min_price }}"
                                            class="w-full px-3 py-2 text-sm border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20">
                                        <span class="text-slate-400">‚Äî</span>
                                        <input type="number" name="max_price" placeholder="Max" value="{{ max_price }}"
                                            class="w-full px-3 py-2 text-sm border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20">
                                    </div>
                                    <button type="submit"
                                        class="w-full py-2 bg-primary text-white text-sm font-semibold rounded-lg hover:bg-yellow-600 transition-colors">Apply</button>
                                </form>
                            </div>

                            <div>
                                <h4 class="text-xs font-bold text-muted-foreground uppercase tracking-wider mb-4">Rating</h4>
                                <div class="space-y-3">
                                    <a href="{% if rating_filter == '4' %}?{% if category_slug %}category={{ category_slug }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}{% else %}?rating=4{% if category_slug %}&category={{ category_slug }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}{% endif %}" 
                                       class="flex items-center gap-3 cursor-pointer hover:text-primary transition-colors {% if rating_filter == '4' %}text-primary font-semibold{% endif %} py-2 px-2 -mx-2 rounded-lg hover:bg-primary/10">
                                        <div class="w-5 h-5 rounded border-2 {% if rating_filter == '4' %}bg-primary border-primary{% else %}border-slate-300{% endif %} flex items-center justify-center">
                                            {% if rating_filter == '4' %}
                                            <svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                            </svg>
                                            {% endif %}
                                        </div>
                                        <span class="text-sm flex items-center gap-1">4 <span class="text-primary">‚òÖ</span> & above</span>
                                    </a>
                                    <a href="{% if rating_filter == '3' %}?{% if category_slug %}category={{ category_slug }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}{% else %}?rating=3{% if category_slug %}&category={{ category_slug }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}{% endif %}" 
                                       class="flex items-center gap-3 cursor-pointer hover:text-primary transition-colors {% if rating_filter == '3' %}text-primary font-semibold{% endif %} py-2 px-2 -mx-2 rounded-lg hover:bg-primary/10">
                                        <div class="w-5 h-5 rounded border-2 {% if rating_filter == '3' %}bg-primary border-primary{% else %}border-slate-300{% endif %} flex items-center justify-center">
                                            {% if rating_filter == '3' %}
                                            <svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                            </svg>
                                            {% endif %}
                                        </div>
                                        <span class="text-sm flex items-center gap-1">3 <span class="text-primary">‚òÖ</span> & above</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </aside>

                <!-- Product Grid Section -->
                <div class="flex-1">
                    <!-- Toolbar -->
                    <div class="flex flex-wrap items-center justify-between mb-8 pb-6 border-b border-slate-100 gap-4">
                        {% if products %}
                        <div class="text-muted-foreground text-sm">Showing <span class="font-bold text-foreground">{{ products.start_index }} - {{ products.end_index }}</span> of <span
                                class="font-bold text-foreground">{{ products.paginator.count }}</span> products
                        </div>
                        {% else %}
                        <div class="text-muted-foreground text-sm"></div>
                        {% endif %}
                        <div class="flex items-center gap-4">
                            <div class="relative">
                                <button id="sort-dropdown-btn"
                                    class="flex items-center gap-2 text-sm font-semibold text-foreground bg-transparent focus:outline-none cursor-pointer">
                                    <span class="text-sm text-muted-foreground">Sort by:</span>
                                    {% if sort_by == 'newest' %}
                                    <span class="font-bold text-foreground">Newest</span>
                                    {% elif sort_by == 'price_low' %}
                                    <span class="font-bold text-foreground">Price: Low to High</span>
                                    {% elif sort_by == 'price_high' %}
                                    <span class="font-bold text-foreground">Price: High to Low</span>
                                    {% elif sort_by == 'rating' %}
                                    <span class="font-bold text-foreground">Top Rated</span>
                                    {% endif %}
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round"
                                        class="text-slate-400 transition-transform" id="sort-dropdown-arrow">
                                        <path d="m6 9 6 6 6-6" />
                                    </svg>
                                </button>
                                <div id="sort-dropdown-menu"
                                    class="absolute z-10 left-0 mt-2 w-48 bg-background rounded-xl shadow-lg border border-green-600 py-2 hidden">
                                    <a href="?sort=newest{% if current_category %}&category={{ current_category.slug }}{% endif %}"
                                        class="block px-4 py-2 text-sm text-muted-foreground hover:bg-primary/10 hover:text-primary font-medium transition-colors {% if sort_by == 'newest' %}bg-primary/10 text-primary{% endif %}">
                                        Newest
                                    </a>
                                    <a href="?sort=price_low{% if current_category %}&category={{ current_category.slug }}{% endif %}"
                                        class="block px-4 py-2 text-sm text-muted-foreground hover:bg-primary/10 hover:text-primary font-medium transition-colors {% if sort_by == 'price_low' %}bg-primary/10 text-primary{% endif %}">
                                        Price: Low to High
                                    </a>
                                    <a href="?sort=price_high{% if current_category %}&category={{ current_category.slug }}{% endif %}"
                                        class="block px-4 py-2 text-sm text-muted-foreground hover:bg-primary/10 hover:text-primary font-medium transition-colors {% if sort_by == 'price_high' %}bg-primary/10 text-primary{% endif %}">
                                        Price: High to Low
                                    </a>
                                    <a href="?sort=rating{% if current_category %}&category={{ current_category.slug }}{% endif %}"
                                        class="block px-4 py-2 text-sm text-muted-foreground hover:bg-primary/10 hover:text-primary font-medium transition-colors {% if sort_by == 'rating' %}bg-primary/10 text-primary{% endif %}">
                                        Top Rated
                                    </a>
                                </div>
                            </div>
                            <div class="h-6 w-px bg-slate-100 mx-2"></div>
                            <div class="flex items-center gap-1">
                                <button
                                    class="w-9 h-9 flex items-center justify-center rounded-lg bg-primary text-white shadow-md">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <rect width="7" height="7" x="3" y="3" rx="1" />
                                        <rect width="7" height="7" x="14" y="3" rx="1" />
                                        <rect width="7" height="7" x="14" y="14" rx="1" />
                                        <rect width="7" height="7" x="3" y="14" rx="1" />
                                    </svg>
                                </button>
                                <button
                                    class="w-9 h-9 flex items-center justify-center rounded-lg bg-white text-slate-400 border border-slate-100 hover:bg-slate-50 transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <line x1="8" y1="6" x2="21" y2="6" />
                                        <line x1="8" y1="12" x2="21" y2="12" />
                                        <line x1="8" y1="18" x2="21" y2="18" />
                                        <line x1="3" y1="6" x2="3.01" y2="6" />
                                        <line x1="3" y1="12" x2="3.01" y2="12" />
                                        <line x1="3" y1="18" x2="3.01" y2="18" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Grid -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 sm:gap-8">
                        {% for product in products %}
                        <!-- Product Item -->
                        <div class="card-product group">
                            <div class="relative aspect-square overflow-hidden bg-slate-100">
                                <a href="{% url 'product_detail' product.id %}" class="block w-full h-full">
                                    {% if product.image %}
                                    <img src="{{ product.image.url }}" alt="{{ product.name }}"
                                        loading="lazy"
                                        decoding="async"
                                        width="300"
                                        height="300"
                                        class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
                                    {% else %}
                                    <div class="w-full h-full flex items-center justify-center text-slate-400">No Image
                                    </div>
                                    {% endif %}
                                </a>

                                <div class="absolute top-3 left-3 flex flex-col gap-2">
                                    {% if product.is_bestseller %}
                                    <span
                                        class="bg-primary text-white text-[10px] font-bold px-2 py-1 rounded-full uppercase">Bestseller</span>
                                    {% endif %}
                                    {% if product.is_out_of_stock %}
                                    <span
                                        class="bg-red-500 text-white text-[10px] font-bold px-2 py-1 rounded-full uppercase">Out of Stock</span>
                                    {% endif %}
                                </div>
                                <button onclick="addToWishlist('{{ product.id }}')"
                                    class="absolute top-3 right-3 w-8 h-8 bg-white/90 backdrop-blur-sm rounded-full flex items-center justify-center text-slate-700 hover:text-red-500 hover:bg-white transition-all shadow-sm sm:opacity-0 sm:group-hover:opacity-100 opacity-100 z-10">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path
                                            d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />
                                    </svg>
                                </button>
                                <div
                                    class="absolute bottom-3 left-3 right-3 flex gap-2 translate-y-4 opacity-0 group-hover:translate-y-0 group-hover:opacity-100 transition-all duration-300 z-10">
                                    {% if product.is_out_of_stock %}
                                    <button disabled
                                        class="flex-1 bg-gray-400 text-white py-2 rounded-lg text-xs font-bold cursor-not-allowed flex items-center justify-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="12" cy="12" r="10"/>
                                            <line x1="15" y1="9" x2="9" y2="15"/>
                                            <line x1="9" y1="9" x2="15" y2="15"/>
                                        </svg>
                                        Out of Stock
                                    </button>
                                    {% else %}
                                    <button onclick="addToCart('{{ product.id }}'); event.stopPropagation();"
                                        class="flex-1 bg-slate-900 text-white py-2 rounded-lg text-xs font-bold hover:bg-primary transition-colors flex items-center justify-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="8" cy="21" r="1" />
                                            <circle cx="19" cy="21" r="1" />
                                            <path
                                                d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12" />
                                        </svg>
                                        Add to Cart
                                    </button>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="p-5">
                                <div class="text-base text-slate-500 mb-3 uppercase tracking-wide font-bold">{{ product.get_category_display }}</div>
                                <div class="flex items-center justify-between mb-3">
                                    <a href="{% url 'product_detail' product.id %}" class="font-bold text-slate-800 text-2xl group-hover:text-primary transition-colors flex-1 mr-2">
                                        {{ product.name }}
                                    </a>
                                    <div class="flex items-center gap-1 shrink-0">
                                        <span class="text-orange-400 text-lg">‚òÖ</span>
                                        <span class="text-base font-bold text-slate-600">({{ product.rating|floatformat:1 }})</span>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="text-2xl font-extrabold text-primary">${{ product.price }}</div>
                                    {% if product.original_price %}
                                    <div class="text-lg text-red-500 line-through font-bold">${{ product.original_price }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="col-span-full text-center py-16">
                            <div
                                class="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4 text-slate-400">
                                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10" />
                                    <line x1="12" y1="8" x2="12" y2="12" />
                                    <line x1="12" y1="16" x2="12.01" y2="16" />
                                </svg>
                            </div>
                            <h3 class="text-xl font-bold text-foreground mb-2">Oops! No product at this time.</h3>
                            <p class="text-muted-foreground">Please check back later or browse other categories.</p>
                        </div>
                        {% endfor %}
                    </div>

                    <!-- Pagination -->
                    {% if products.has_other_pages %}
                    <div class="mt-12 pt-8 border-t border-slate-100 flex items-center justify-center">
                        <div class="flex gap-2">
                            {% if products.has_previous %}
                            <a href="?page={{ products.previous_page_number }}&sort={{ sort_by }}"
                                class="w-10 h-10 border border-slate-200 rounded-lg flex items-center justify-center font-semibold text-slate-600 hover:border-primary hover:text-primary transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="m15 18-6-6 6-6" />
                                </svg>
                            </a>
                            {% endif %}
                            <span
                                class="w-10 h-10 bg-primary text-white rounded-lg flex items-center justify-center font-bold">
                                {{ products.number }}
                            </span>
                            {% if products.has_next %}
                            <a href="?page={{ products.next_page_number }}&sort={{ sort_by }}"
                                class="w-10 h-10 border border-slate-200 rounded-lg flex items-center justify-center font-semibold text-slate-600 hover:border-primary hover:text-primary transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="m9 18 6-6-6-6" />
                                </svg>
                            </a>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </section>
</main>
{% endblock %}

{% block extra_js %}
<script>
    // Shop Page Specific Logic
    document.addEventListener('DOMContentLoaded', () => {
        // Filter toggle functionality
        const filterToggle = document.getElementById('filter-toggle');
        const filterContent = document.getElementById('filter-content');

        if (filterToggle && filterContent) {
            filterToggle.addEventListener('click', (e) => {
                e.preventDefault();
                const isHidden = filterContent.classList.contains('hidden');
                
                if (isHidden) {
                    filterContent.classList.remove('hidden');
                    filterToggle.querySelector('span').textContent = 'Hide Filters';
                    filterToggle.querySelector('svg').style.transform = 'rotate(180deg)';
                } else {
                    filterContent.classList.add('hidden');
                    filterToggle.querySelector('span').textContent = 'Expand Filters';
                    filterToggle.querySelector('svg').style.transform = 'rotate(0deg)';
                }
            });
        }

        // Sort dropdown functionality
        const sortBtn = document.getElementById('sort-dropdown-btn');
        const sortMenu = document.getElementById('sort-dropdown-menu');
        const sortArrow = document.getElementById('sort-dropdown-arrow');

        if (sortBtn && sortMenu) {
            sortBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                const isHidden = sortMenu.classList.contains('hidden');
                sortMenu.classList.toggle('hidden');
                sortArrow.style.transform = isHidden ? 'rotate(180deg)' : 'rotate(0deg)';
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', () => {
                sortMenu.classList.add('hidden');
                sortArrow.style.transform = 'rotate(0deg)';
            });

            // Prevent dropdown from closing when clicking inside
            sortMenu.addEventListener('click', (e) => {
                e.stopPropagation();
            });
        }
    });
</script>
{% endblock %}